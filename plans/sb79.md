# SB79: Transit Stop Distance Rule

## Goal
Allow users to set a rule type that is "all units within X distance of a transit stop" (which mirrors SB79).

## Implementation Strategy

### 1. Data Preparation
- Load transit data from `data/transit-bart.geojson`, `data/transit-caltrain.geojson`, and `data/transit-muni.geojson`.
- Combine these into a single list of transit stop coordinates.
- For each parcel in `parcels.csv`, calculate the distance to the nearest transit stop.
- Store this `distance_to_transit` (in feet or meters) in the `parcelAttributes` map in `MapView.vue`.

### 2. Distance Calculation
- Since we have ~150k parcels, we need an efficient way to calculate distances.
- Suggestion: Use a simple Haversine formula or Mapbox's `lngLat.distanceTo` for each parcel against a pre-sampled/filtered list of stops if needed.
- Better: Pre-calculate this during the data loading phase in `loadDataset()`.

### 3. Rule Schema Update
- Update the `userRules` objects to include an optional `transitDistance` property.
- Update `ruleMatchesParcel(rule, parcelAttrs)` to check:
  ```javascript
  if (rule.transitDistance && parcelAttrs.distanceToTransit > rule.transitDistance) {
    return false;
  }
  ```

### 4. UI Changes
- **Modal**: Add a section in the "Natural Language Form" for transit distance.
  - "within [____] ft of a transit stop"
- **Rule Item**: Display the distance criteria in the sidebar (e.g., "within 1320 ft of transit").

### 5. Performance Considerations
- Distance calculation for 150k parcels might be slow if done every time. Pre-calculating once on load and storing in the map is best.

## Verification Plan
1. Add a rule with a height limit and a transit distance filter.
2. Observe the map to see if parcels matching the criteria are highlighted/updated.
3. Verify the total expected units change accordingly.
